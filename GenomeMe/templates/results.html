{% extends 'base.html' %}
{% block main %}
<!--D3.js requirements-->


<div id='results'>
    <!--<svg id="bar" width="100%" height="360" fontFamily="sans-serif" textAnchor="middle"></svg>-->
</div>
<table id="dtable" class="table">
    <thead id='theader'>
    </thead>
    <tbody id="tbody">
    </tbody>
</table>
<!--<script type="text/jsx" src="/static/js/results.jsx"></script>-->

<script>
    var data = {{ session['data']['hits']|safe }};
    var counts = Object.values({{ count_by_type.to_json()|safe }});
    var countsKeys = Object.keys({{ count_by_type.to_json()|safe }});
    var height = 100, width=200, barPadding = 2;
    var barGraph = d3.select("#results")
                     .append("svg")
                     .attr("width", width)
                     .attr('height', height);

    barGraph.selectAll("rect")
            .data(counts)
            .enter()
            .append("rect")
            .attr("x", function(d, i) {
                return i * (width/counts.length);
            })
            .attr("y", function(d) {
                return height - d*10;
            })
            .attr("width", width/counts.length - barPadding)
            .attr("height", height)
            .attr("fill", function(d, i) {
                return "rgb(255,0,0)"
            });
    barGraph.selectAll("text")
            .data(countsKeys)
            .enter()
            .append("text")
            .text(function(d,i) {
                return d.slice(0, 5);
            })
            .attr("x", function(d, i) {
                return i * (width/counts.length);
            })
            .attr("y", function(d) {
                return height - height/2;
            })
            // .attr("rotate", -90 )
            ;


    

    console.log(counts, countsKeys);
    

    // Build Datatable
    var datakeys = Object.keys(data[0]);
    var header = document.getElementById("theader");
    var datadiv = document.getElementById("tbody");
    var tempkey = null,
        row = null,
        row_data = null;

    // Append header
    row = document.createElement("tr");
    for (var k=0; k < datakeys.length; k++) {
        row_data = document.createElement("th");
        row_data.innerHTML = datakeys[k];
        row.appendChild(row_data);
    }
    header.appendChild(row);

    // Append rows
    for(var i=0; i < data.length; i++){

        row = document.createElement("tr");

        for (var k=0; k < datakeys.length; k++) {
            tempkey = datakeys[k];
            row_data = document.createElement("td");
            row_data.innerHTML = data[i][tempkey];
            row.appendChild(row_data);
        }
        datadiv.appendChild(row);
    }

    $(document).ready(function (){
        $("#dtable").DataTable();
    });
</script>
{% endblock %}